#!/bin/sh

# This script wraps up helm deployment. It is meant as a clear starting point for
# commandline deployment or CI based deployment. It requires the following ENV vars be set
#
if [ -z "$1" ] || [ -z "$2" ]
then
    echo './bin/deploy RELEASE_NAME NAMESPACE'
    exit 1
fi
release_name="${1}"
namespace="${2}"

helm repo update

chart="${1}"

helm upgrade \
    --install \
    --atomic \
    --timeout 15m0s \
    --set image.repository="$DEPLOY_IMAGE" \
    --set image.tag="$DEPLOY_TAG" \
    $HELM_EXTRA_ARGS \
    --namespace="$namespace" \
    --create-namespace \
    "$release_name" \
    "${chart}"
